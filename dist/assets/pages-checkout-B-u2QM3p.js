import{r as e,j as s,b as a,aF as t,az as r,H as i,P as l,z as n}from"./vendor-I9hkboGq.js";import{e as d,d as c,l as o,u as m}from"./contexts-Cb1lEMMf.js";import{ak as x,al as u,am as h,an as p,ah as g,ao as b,ap as y,aq as f,ar as j,as as N,at as v,au as w,av as C}from"./index-CzTquisR.js";import{e as k}from"./services-BbBFH2H7.js";import{m as S}from"./ui-CFZ2Pk_Q.js";import"./utils-DOabGuGE.js";import"./supabase-BIpeaN6O.js";import"./product-C38Xnw-V.js";const q=()=>{const{items:q,total:P,clearCart:z}=d(),{user:D}=c(),{createOrder:F}=o(),{showNotification:E}=m(),{isMobile:I}=x(),[M,$]=e.useState(1),[T,Y]=e.useState(!1),[A,O]=e.useState(null),[R,V]=e.useState("razorpay"),[H,B]=e.useState(!1),[L,G]=e.useState({firstName:"",lastName:"",email:(null==D?void 0:D.email)||"",phone:"",address:"",city:"",state:"",zipCode:"",country:"India",cardNumber:"",expiryDate:"",cvv:"",cardName:"",saveInfo:!1,sameAsBilling:!0}),Q=P,_=Math.round(.18*Q*100)/100,J=Q>=2e3?0:L.state.toLowerCase().includes("kashmir")?50:100,K=Q+_+J,U=e=>{const{name:s,value:a,type:t}=e.target;G(r=>({...r,[s]:"checkbox"===t?e.target.checked:a}))},W=e=>{if(1===e){if(!(L.firstName&&L.lastName&&L.email&&L.phone&&L.address&&L.city&&L.state))return E({type:"error",title:"Validation Error",message:"Please fill in all required shipping information."}),!1;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(L.email))return E({type:"error",title:"Invalid Email",message:"Please enter a valid email address."}),!1}if(2===e){if(!(L.cardNumber&&L.expiryDate&&L.cvv&&L.cardName))return E({type:"error",title:"Validation Error",message:"Please fill in all required payment information."}),!1;if(L.cardNumber.replace(/\s/g,"").length<16)return E({type:"error",title:"Invalid Card Number",message:"Please enter a valid card number."}),!1;if(!/^\d{2}\/\d{2}$/.test(L.expiryDate))return E({type:"error",title:"Invalid Expiry Date",message:"Please enter expiry date in MM/YY format."}),!1;if(L.cvv.length<3)return E({type:"error",title:"Invalid CVV",message:"Please enter a valid CVV."}),!1}return!0},X=e=>{W(M)&&$(e)},Z=async e=>{const s={fullName:`${L.firstName} ${L.lastName}`,streetAddress:L.address,city:L.city,state:L.state,postalCode:L.zipCode,country:L.country,phone:L.phone,street:L.address,zipCode:L.zipCode};let a=null;if(a=D?await F(q,s,void 0,"cod"===R?"Cash on Delivery":"Razorpay"):await C({items:q,shippingAddress:s,paymentMethod:"cod"===R?"Cash on Delivery":"Razorpay",guestEmail:L.email,guestName:`${L.firstName} ${L.lastName}`,paymentId:e}),a){O(a),Y(!0),B(!1),z();try{await k.sendOrderConfirmationEmail({email:L.email,name:`${L.firstName} ${L.lastName}`,orderId:a,items:q.map(e=>({name:e.product.name,quantity:e.quantity,price:e.product.price,image:e.product.images[0]})),subtotal:Q,gst:_,shipping:J,total:K,shippingAddress:{street:L.address,city:L.city,state:L.state,zipCode:L.zipCode,country:L.country},paymentMethod:"cod"===R?"Cash on Delivery":"Razorpay"})}catch(t){}}},ee=async()=>{W(M)&&("cod"===R?await Z("cod_"+Date.now()):B(!0))};if(0===q.length&&!T)return s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Your Cart is Empty"}),s.jsx("p",{className:"text-gray-600",children:"Add some items to your cart before checking out."})]})});if(T)return s.jsx("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center p-4",children:s.jsxs(S.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"max-w-lg mx-auto bg-white rounded-2xl shadow-2xl p-10 text-center border border-neutral-200",children:[s.jsx("div",{className:"w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-8",children:s.jsx(a,{className:"h-10 w-10 text-emerald-600"})}),s.jsx("h1",{className:"text-3xl font-bold text-neutral-900 mb-4 font-luxury",children:"Order Confirmed!"}),s.jsxs("p",{className:"text-neutral-600 mb-8 leading-relaxed",children:["Thank you for your purchase. Your order ",s.jsxs("span",{className:"font-mono font-medium",children:["#",null==A?void 0:A.slice(0,8)]})," has been placed successfully and you'll receive a confirmation email shortly."]}),s.jsx("div",{className:"bg-neutral-50 rounded-xl p-6 mb-8",children:s.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold text-emerald-600 mb-1",children:"âœ“"}),s.jsx("div",{className:"text-xs text-neutral-600",children:"Secure Payment"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:"ðŸ“¦"}),s.jsx("div",{className:"text-xs text-neutral-600",children:"Fast Shipping"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold text-purple-600 mb-1",children:"ðŸ”„"}),s.jsx("div",{className:"text-xs text-neutral-600",children:"Easy Returns"})]})]})}),s.jsx("div",{className:"space-y-4",children:D?s.jsxs(s.Fragment,{children:[s.jsx(t,{to:"/orders",children:s.jsx("button",{className:"w-full btn-primary btn-lg",children:"Track Your Order"})}),s.jsx(t,{to:"/products",children:s.jsx("button",{className:"w-full btn-secondary btn-lg",children:"Continue Shopping"})})]}):s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"text-sm text-neutral-500 mb-6 bg-blue-50 p-4 rounded-lg border border-blue-200",children:["A confirmation email has been sent to ",s.jsx("span",{className:"font-medium",children:L.email})," with your order details."]}),s.jsx(t,{to:"/products",children:s.jsx("button",{className:"w-full btn-primary btn-lg",children:"Continue Shopping"})}),s.jsx(t,{to:"/auth/login",children:s.jsx("button",{className:"w-full btn-secondary btn-lg",children:"Create an Account"})})]})})]})});if(I){const e=()=>{switch(M){case 1:return"Shipping Information";case 2:return"Payment Method";case 3:return"Review Order";default:return"Checkout"}},a=()=>{switch(M){case 1:return L.firstName&&L.lastName&&L.email&&L.phone&&L.address&&L.city&&L.state&&L.zipCode;case 2:return"card"!==R||L.cardNumber&&L.expiryDate&&L.cvv&&L.cardName;case 3:return!0;default:return!1}},t=e=>{W(M)&&$(e)},r=()=>{switch(M){case 1:return s.jsx(w,{formData:L,onChange:U});case 2:return s.jsxs("div",{className:"space-y-6",children:[s.jsx(N,{selectedMethod:R,onMethodChange:V}),s.jsx(v,{formData:L,onChange:U,selectedPaymentMethod:R})]});case 3:return s.jsx(j,{items:q,subtotal:Q,shipping:shippingCost,tax:tax,total:K});default:return null}};return s.jsxs(s.Fragment,{children:[s.jsx(u,{currentStep:M,totalSteps:3,onStepChange:t,onBack:()=>M>1?$(M-1):window.history.back(),stepTitle:e(),canProceed:a(),children:r()}),s.jsx(h,{currentStep:M,totalSteps:3,onBack:M>1?()=>$(M-1):void 0,onNext:M<3?()=>t(M+1):ee,canProceed:a(),isLoading:!1})]})}return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white shadow-sm border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(t,{to:"/products",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(r,{className:"h-5 w-5"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Checkout"}),s.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[s.jsxs("div",{className:"flex items-center space-x-2 "+(M>=1?"text-indigo-600":"text-gray-400"),children:[s.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium "+(M>=1?"bg-indigo-600 text-white":"bg-gray-200"),children:"1"}),s.jsx("span",{className:"text-sm font-medium",children:"Shipping"})]}),s.jsx("div",{className:"w-8 h-px bg-gray-300"}),s.jsxs("div",{className:"flex items-center space-x-2 "+(M>=2?"text-indigo-600":"text-gray-400"),children:[s.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium "+(M>=2?"bg-indigo-600 text-white":"bg-gray-200"),children:"2"}),s.jsx("span",{className:"text-sm font-medium",children:"Payment"})]}),s.jsx("div",{className:"w-8 h-px bg-gray-300"}),s.jsxs("div",{className:"flex items-center space-x-2 "+(M>=3?"text-indigo-600":"text-gray-400"),children:[s.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium "+(M>=3?"bg-indigo-600 text-white":"bg-gray-200"),children:"3"}),s.jsx("span",{className:"text-sm font-medium",children:"Review"})]})]})]})]})})}),s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"lg:col-span-2",children:[1===M&&s.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[s.jsx(i,{className:"h-5 w-5 mr-2"}),"Shipping Information"]}),!D&&s.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(l,{className:"h-5 w-5 text-blue-600"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-sm font-medium text-blue-900",children:"Guest Checkout"}),s.jsx("p",{className:"text-sm text-blue-700",children:"You're checking out as a guest. You'll receive order updates via email."})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),s.jsx("input",{type:"text",name:"firstName",value:L.firstName,onChange:U,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),s.jsx("input",{type:"text",name:"lastName",value:L.lastName,onChange:U,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),s.jsx("input",{type:"email",name:"email",value:L.email,onChange:U,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),s.jsx("input",{type:"tel",name:"phone",value:L.phone,onChange:U,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),s.jsx("input",{type:"text",name:"address",value:L.address,onChange:U,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City"}),s.jsx("input",{type:"text",name:"city",value:L.city,onChange:U,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),s.jsx("input",{type:"text",name:"state",value:L.state,onChange:U,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0})]})]}),s.jsx("div",{className:"mt-8 flex justify-end",children:s.jsx(S.button,{onClick:()=>X(2),className:"btn-primary",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Continue to Payment"})})]}),2===M&&s.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[s.jsx(n,{className:"h-5 w-5 mr-2"}),"Payment Information"]}),s.jsxs("div",{className:"mb-6",children:[s.jsx(p,{className:"mb-4"}),s.jsx(g,{variant:"compact",showLabels:!1,className:"justify-center"})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Card Number"}),s.jsx("input",{type:"text",name:"cardNumber",value:L.cardNumber,onChange:U,placeholder:"1234 5678 9012 3456",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiry Date"}),s.jsx("input",{type:"text",name:"expiryDate",value:L.expiryDate,onChange:U,placeholder:"MM/YY",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CVV"}),s.jsx("input",{type:"text",name:"cvv",value:L.cvv,onChange:U,placeholder:"123",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name on Card"}),s.jsx("input",{type:"text",name:"cardName",value:L.cardName,onChange:U,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0})]})]}),s.jsxs("div",{className:"mt-8 flex justify-between",children:[s.jsx(S.button,{onClick:()=>$(1),className:"btn-secondary",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Back"}),s.jsx(S.button,{onClick:()=>X(3),className:"btn-primary",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Review Order"})]})]}),3===M&&s.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[s.jsx(l,{className:"h-5 w-5 mr-2"}),"Review Your Order"]}),s.jsx("div",{className:"space-y-4 mb-8",children:q.map(e=>s.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg",children:[s.jsx("img",{src:e.product.images[0],alt:e.product.name,className:"w-16 h-16 object-cover rounded-lg"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:e.product.name}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Quantity: ",e.quantity]})]}),s.jsx("div",{className:"text-right",children:s.jsxs("p",{className:"font-semibold text-gray-900",children:["â‚¹",(e.product.price*e.quantity).toFixed(2)]})})]},e.product.id))}),s.jsx(b,{className:"mb-6"}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx(S.button,{onClick:()=>$(2),className:"btn-secondary",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Back"}),s.jsx(S.button,{onClick:ee,className:"btn-primary !bg-green-600 !hover:bg-green-700 !focus:ring-green-600/20",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Place Order"})]})]})]}),s.jsx("div",{className:"lg:col-span-1",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 sticky top-28",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Order Summary"}),s.jsxs("div",{className:"space-y-3 mb-6",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Subtotal"}),s.jsxs("span",{className:"font-medium",children:["â‚¹",Q.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"GST (18%)"}),s.jsxs("span",{className:"font-medium",children:["â‚¹",_.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Shipping"}),s.jsx("span",{className:"font-medium",children:0===J?s.jsx("span",{className:"text-green-600 font-semibold",children:"FREE"}):`â‚¹${J.toFixed(2)}`})]}),0===J&&s.jsx("div",{className:"text-xs text-green-600 text-right",children:"Free shipping on orders â‰¥ â‚¹2,000"}),s.jsx("div",{className:"border-t border-gray-200 pt-3",children:s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total"}),s.jsxs("span",{className:"text-lg font-bold text-indigo-600",children:["â‚¹",K.toFixed(2)]})]})})]}),s.jsx(y,{})]})})]})}),H&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsx("div",{className:"max-w-md w-full",children:s.jsx(f,{amount:Q,items:q,customerInfo:{name:`${L.firstName} ${L.lastName}`,email:L.email,phone:L.phone},shippingAddress:{street:L.address,city:L.city,state:L.state,zipCode:L.zipCode,country:L.country},onSuccess:Z,onError:e=>{E({type:"error",title:"Payment Failed",message:e}),B(!1)},onCancel:()=>{B(!1)}})})})]})};export{q as CheckoutPage,q as default};
//# sourceMappingURL=pages-checkout-B-u2QM3p.js.map
