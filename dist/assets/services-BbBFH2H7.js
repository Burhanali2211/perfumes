var e=Object.defineProperty,t=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);import{s as n}from"./index-CzTquisR.js";const r="recentlyViewed";const i=new class{constructor(){t(this,"sessionId"),this.sessionId=this.generateSessionId()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}addProduct(e){try{const t=this.getRecentlyViewed().filter(t=>t.productId!==e),n=[{productId:e,viewedAt:Date.now(),sessionId:this.sessionId},...t].slice(0,20);localStorage.setItem(r,JSON.stringify(n)),window.dispatchEvent(new CustomEvent("recentlyViewedUpdated",{detail:{productId:e,items:n}}))}catch(t){}}getRecentlyViewed(){try{const e=localStorage.getItem(r);if(!e)return[];const t=JSON.parse(e),n=Date.now()-2592e6,i=t.filter(e=>e.viewedAt>n);return i.length!==t.length&&localStorage.setItem(r,JSON.stringify(i)),i}catch(e){return[]}}getRecentlyViewedIds(){return this.getRecentlyViewed().map(e=>e.productId)}removeProduct(e){try{const t=this.getRecentlyViewed().filter(t=>t.productId!==e);localStorage.setItem(r,JSON.stringify(t)),window.dispatchEvent(new CustomEvent("recentlyViewedUpdated",{detail:{productId:e,items:t,action:"removed"}}))}catch(t){}}clearAll(){try{localStorage.removeItem(r),window.dispatchEvent(new CustomEvent("recentlyViewedUpdated",{detail:{items:[],action:"cleared"}}))}catch(e){}}getRecentlyViewedProducts(e){return this.getRecentlyViewedIds().map(t=>e.find(e=>e.id===t)).filter(e=>void 0!==e)}getAnalytics(){const e=this.getRecentlyViewed(),t=new Set(e.map(e=>e.productId)).size,n=new Set(e.map(e=>e.sessionId)).size,r={};e.forEach(e=>{const t=new Date(e.viewedAt).getHours();r[t]=(r[t]||0)+1});const i=Object.entries(r).map(([e,t])=>({hour:parseInt(e),count:t})).sort((e,t)=>e.hour-t.hour);return{totalViewed:e.length,uniqueProducts:t,averageViewsPerSession:n>0?e.length/n:0,topViewedCategories:[],viewingPatterns:i}}getViewingBasedRecommendations(e,t=8){const n=this.getRecentlyViewedProducts(e);if(0===n.length)return e.filter(e=>e.featured||e.rating>=4).sort((e,t)=>t.rating-e.rating).slice(0,t);const r=[...new Set(n.map(e=>e.category))],i=[...new Set(n.map(e=>e.brand).filter(Boolean))],a=new Set(n.map(e=>e.id));return e.filter(e=>!a.has(e.id)).map(e=>{let t=0;r.includes(e.category)&&(t+=30),e.brand&&i.includes(e.brand)&&(t+=20),t+=10*e.rating,e.featured&&(t+=15);const a=n.reduce((e,t)=>e+t.price,0)/n.length;return Math.abs(e.price-a)/a<=.5&&(t+=10),{product:e,score:t}}).sort((e,t)=>t.score-e.score).slice(0,t).map(e=>e.product)}isRecentlyViewed(e){return this.getRecentlyViewedIds().includes(e)}getLastViewedTime(e){const t=this.getRecentlyViewed().find(t=>t.productId===e);return t?t.viewedAt:null}};class a{static getBucketName(e){return e.startsWith("products")?this.BUCKETS.PRODUCTS:e.startsWith("categories")?this.BUCKETS.CATEGORIES:e.startsWith("collections/banners")?this.BUCKETS.COLLECTION_BANNERS:e.startsWith("collections")?this.BUCKETS.COLLECTIONS:e.startsWith("users")?this.BUCKETS.USERS:e.startsWith("marketing")?this.BUCKETS.MARKETING:this.BUCKETS.PRODUCTS}static async uploadImage(e,t="products",r){var i;try{const a=this.validateFile(e);if(!a.isValid)return{url:"",path:"",error:a.error};const s=this.getBucketName(t);await this.initializeAllBuckets();const o=e.name.split(".").pop(),d=`${t}/${`${Date.now()}-${Math.random().toString(36).substring(2)}.${o}`}`;r&&r({loaded:0,total:e.size,percentage:0});const{data:c,error:l}=await n.storage.from(s).upload(d,e,{cacheControl:"3600",upsert:!1});if(l){if((null==(i=l.message)?void 0:i.includes("Bucket not found"))||400===l.status){await this.initializeAllBuckets();const t=await n.storage.from(s).upload(d,e,{cacheControl:"3600",upsert:!1});if(t.error)return{url:"",path:"",error:t.error.message};const{data:r}=n.storage.from(s).getPublicUrl(t.data.path);return{url:r.publicUrl,path:t.data.path}}return{url:"",path:"",error:l.message}}r&&r({loaded:e.size,total:e.size,percentage:100});const{data:p}=n.storage.from(s).getPublicUrl(c.path);return{url:p.publicUrl,path:c.path}}catch(a){return{url:"",path:"",error:a instanceof Error?a.message:"Upload failed"}}}static async deleteImage(e,t="products"){try{const r=this.getBucketName(t),{error:i}=await n.storage.from(r).remove([e]);return!i}catch(r){return!1}}static validateFile(e){if(e.size>this.MAX_FILE_SIZE){return{isValid:!1,error:`File size must be less than ${this.MAX_FILE_SIZE/1024/1024}MB`}}if(!this.ALLOWED_TYPES.includes(e.type)){return{isValid:!1,error:"Only JPEG, PNG, and WebP images are allowed"}}return{isValid:!0}}static getOptimizedImageUrl(e,t={}){if(!e)return e;if(e.includes("supabase")){const n=new URLSearchParams;if(t.width&&n.append("width",t.width.toString()),t.height&&n.append("height",t.height.toString()),t.quality&&n.append("quality",t.quality.toString()),n.toString())return`${e}?${n.toString()}`}return e}static async createBucketIfNotExists(e){try{const{data:t,error:r}=await n.storage.listBuckets();if(r)return!1;if(!(null==t?void 0:t.some(t=>t.name===e))){const{error:t}=await n.storage.createBucket(e,{public:!0,allowedMimeTypes:this.ALLOWED_TYPES,fileSizeLimit:this.MAX_FILE_SIZE});if(t)return!1}return!0}catch(t){return!1}}static async initializeAllBuckets(){try{const e=Object.values(this.BUCKETS),t=await Promise.all(e.map(e=>this.createBucketIfNotExists(e)));return t.every(e=>e)}catch(e){return!1}}static async initializeBucket(){return this.initializeAllBuckets()}}t(a,"BUCKETS",{PRODUCTS:"products",CATEGORIES:"categories",COLLECTIONS:"collections",COLLECTION_BANNERS:"collection-banners",USERS:"users",MARKETING:"marketing"}),t(a,"MAX_FILE_SIZE",5242880),t(a,"ALLOWED_TYPES",["image/jpeg","image/jpg","image/png","image/webp"]);try{"undefined"!=typeof window&&(window.__StorageService=a)}catch{}const s=new class{constructor(){t(this,"fromEmail","noreply@sufiessences.com"),t(this,"fromName","Sufi Essences Admin")}generateUserCreationTemplate(e){const{name:t,email:n,password:r,role:i,confirmationUrl:a}=e;return{subject:"Welcome to Sufi Essences - Your Account Has Been Created",htmlContent:`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset="utf-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Welcome to Sufi Essences</title>\n        <style>\n          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n          .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n          .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }\n          .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }\n          .credentials { background: #fff; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #667eea; }\n          .button { display: inline-block; background: #667eea; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; margin: 20px 0; }\n          .footer { text-align: center; margin-top: 30px; color: #666; font-size: 14px; }\n          .warning { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 20px 0; }\n        </style>\n      </head>\n      <body>\n        <div class="container">\n          <div class="header">\n            <h1>Welcome to Sufi Essences</h1>\n            <p>Your account has been created successfully</p>\n          </div>\n          <div class="content">\n            <h2>Hello ${t},</h2>\n            <p>Your administrator has created an account for you on Sufi Essences with the role of <strong>${i}</strong>.</p>\n            \n            <div class="credentials">\n              <h3>Your Login Credentials:</h3>\n              <p><strong>Email:</strong> ${n}</p>\n              <p><strong>Temporary Password:</strong> <code>${r}</code></p>\n            </div>\n            \n            <div class="warning">\n              <strong>Important:</strong> Please change your password after your first login for security purposes.\n            </div>\n            \n            ${a?`\n              <p>Please click the button below to confirm your email address and activate your account:</p>\n              <a href="${a}" class="button">Confirm Email Address</a>\n              <p>If the button doesn't work, copy and paste this link into your browser:</p>\n              <p><a href="${a}">${a}</a></p>\n            `:`\n              <p>Your account is ready to use. You can log in immediately with the credentials above.</p>\n              <a href="${window.location.origin}/login" class="button">Login to Your Account</a>\n            `}\n            \n            <h3>What's Next?</h3>\n            <ul>\n              <li>Log in to your account using the credentials above</li>\n              <li>Complete your profile information</li>\n              <li>Change your password for security</li>\n              <li>Explore the platform features available to your role</li>\n            </ul>\n            \n            <p>If you have any questions or need assistance, please don't hesitate to contact our support team.</p>\n            \n            <p>Best regards,<br>The Sufi Essences Team</p>\n          </div>\n          <div class="footer">\n            <p>This email was sent from Sufi Essences Admin Panel</p>\n            <p>If you didn't expect this email, please contact our support team immediately.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `,textContent:`\nWelcome to Sufi Essences\n\nHello ${t},\n\nYour administrator has created an account for you on Sufi Essences with the role of ${i}.\n\nYour Login Credentials:\nEmail: ${n}\nTemporary Password: ${r}\n\nIMPORTANT: Please change your password after your first login for security purposes.\n\n${a?`\nPlease confirm your email address by visiting this link:\n${a}\n`:`\nYour account is ready to use. You can log in immediately at:\n${window.location.origin}/login\n`}\n\nWhat's Next:\n- Log in to your account using the credentials above\n- Complete your profile information\n- Change your password for security\n- Explore the platform features available to your role\n\nIf you have any questions or need assistance, please contact our support team.\n\nBest regards,\nThe Sufi Essences Team\n\n---\nThis email was sent from Sufi Essences Admin Panel\nIf you didn't expect this email, please contact our support team immediately.\n    `}}async sendEmail(e,t,n){try{const r=await fetch("/.netlify/functions/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:e,from:this.fromEmail,fromName:this.fromName,subject:t.subject,html:t.htmlContent,text:t.textContent,metadata:n})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const i=await r.json();if(!i.success)throw new Error(i.error||"Email sending failed");return{success:!0,messageId:i.messageId}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown email error"}}}async sendUserCreationEmail(e){const t=this.generateUserCreationTemplate(e);return this.sendEmail(e.email,t,{type:"user_creation",role:e.role,hasConfirmation:!!e.confirmationUrl})}async sendOrderConfirmationEmail(e){const t=this.generateOrderConfirmationTemplate(e);return this.sendEmail(e.email,t,{type:"order_confirmation",orderId:e.orderId,total:e.total})}async sendOrderStatusUpdateEmail(e){const t=this.generateOrderStatusTemplate(e);return this.sendEmail(e.email,t,{type:"order_status_update",orderId:e.orderId,status:e.status})}async sendWelcomeEmail(e){const t=this.generateWelcomeTemplate(e);return this.sendEmail(e.email,t,{type:"welcome",userEmail:e.email})}async sendConfirmationReminder(e,t,n){const r={subject:"Please Confirm Your Email Address - Sufi Essences",htmlContent:`\n        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">\n          <h2>Email Confirmation Required</h2>\n          <p>Hello ${t},</p>\n          <p>Please confirm your email address to complete your account setup:</p>\n          <a href="${n}" style="background: #667eea; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block; margin: 20px 0;">Confirm Email</a>\n          <p>If the button doesn't work, copy and paste this link: ${n}</p>\n        </div>\n      `,textContent:`\nEmail Confirmation Required\n\nHello ${t},\n\nPlease confirm your email address to complete your account setup by visiting:\n${n}\n\nBest regards,\nThe Sufi Essences Team\n      `};return this.sendEmail(e,r,{type:"confirmation_reminder"})}async sendPasswordResetEmail(e,t,n){const r={subject:"Your Password Has Been Reset - Sufi Essences",htmlContent:`\n        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">\n          <h2>Password Reset</h2>\n          <p>Hello ${t},</p>\n          <p>Your password has been reset by an administrator.</p>\n          <div style="background: #f9f9f9; padding: 20px; border-radius: 5px; margin: 20px 0;">\n            <p><strong>New Password:</strong> <code>${n}</code></p>\n          </div>\n          <p><strong>Important:</strong> Please change this password after logging in.</p>\n          <a href="${window.location.origin}/login" style="background: #667eea; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block; margin: 20px 0;">Login Now</a>\n        </div>\n      `,textContent:`\nPassword Reset\n\nHello ${t},\n\nYour password has been reset by an administrator.\n\nNew Password: ${n}\n\nIMPORTANT: Please change this password after logging in.\n\nLogin at: ${window.location.origin}/login\n\nBest regards,\nThe Sufi Essences Team\n      `};return this.sendEmail(e,r,{type:"password_reset"})}generateOrderConfirmationTemplate(e){const t=e.items.map(e=>`\n      <tr>\n        <td style="padding: 10px; border-bottom: 1px solid #eee;">\n          <div style="display: flex; align-items: center;">\n            ${e.image?`<img src="${e.image}" alt="${e.name}" style="width: 50px; height: 50px; object-fit: cover; margin-right: 10px; border-radius: 4px;">`:""}\n            <div>\n              <strong>${e.name}</strong><br>\n              <small>Quantity: ${e.quantity}</small>\n            </div>\n          </div>\n        </td>\n        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">\n          ₹${(e.price*e.quantity).toFixed(2)}\n        </td>\n      </tr>\n    `).join(""),n=`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset="utf-8">\n        <title>Order Confirmation - Sufi Essences</title>\n        <style>\n          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n          .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n          .header { background: linear-gradient(135deg, #8B5A3C, #A0522D); color: white; padding: 30px; text-align: center; border-radius: 8px 8px 0 0; }\n          .content { background: white; padding: 30px; border: 1px solid #ddd; }\n          .footer { background: #f8f9fa; padding: 20px; text-align: center; border-radius: 0 0 8px 8px; }\n          .order-summary { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }\n          .total-row { font-weight: bold; font-size: 18px; color: #8B5A3C; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          .btn { background: #8B5A3C; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block; margin: 10px 0; }\n        </style>\n      </head>\n      <body>\n        <div class="container">\n          <div class="header">\n            <h1>🌸 Order Confirmed!</h1>\n            <p>Thank you for your purchase from Sufi Essences</p>\n          </div>\n\n          <div class="content">\n            <p>Dear ${e.name},</p>\n\n            <p>Your order has been confirmed and is being prepared for shipment. Here are your order details:</p>\n\n            <div class="order-summary">\n              <h3>Order #${e.orderId}</h3>\n              <p><strong>Payment Method:</strong> ${e.paymentMethod}</p>\n              <p><strong>Shipping Address:</strong><br>\n                ${e.shippingAddress.street}<br>\n                ${e.shippingAddress.city}, ${e.shippingAddress.state} ${e.shippingAddress.zipCode}<br>\n                ${e.shippingAddress.country}\n              </p>\n            </div>\n\n            <h3>Order Items:</h3>\n            <table>\n              ${t}\n              <tr>\n                <td style="padding: 10px; text-align: right;"><strong>Subtotal:</strong></td>\n                <td style="padding: 10px; text-align: right;"><strong>₹${e.subtotal.toFixed(2)}</strong></td>\n              </tr>\n              <tr>\n                <td style="padding: 10px; text-align: right;">GST (18%):</td>\n                <td style="padding: 10px; text-align: right;">₹${e.gst.toFixed(2)}</td>\n              </tr>\n              <tr>\n                <td style="padding: 10px; text-align: right;">Shipping:</td>\n                <td style="padding: 10px; text-align: right;">${0===e.shipping?"FREE":"₹"+e.shipping.toFixed(2)}</td>\n              </tr>\n              <tr class="total-row">\n                <td style="padding: 15px; text-align: right; border-top: 2px solid #8B5A3C;">Total:</td>\n                <td style="padding: 15px; text-align: right; border-top: 2px solid #8B5A3C;">₹${e.total.toFixed(2)}</td>\n              </tr>\n            </table>\n\n            <p>We'll send you another email with tracking information once your order ships.</p>\n\n            <div style="text-align: center; margin: 30px 0;">\n              <a href="${window.location.origin}/orders" class="btn">Track Your Order</a>\n            </div>\n          </div>\n\n          <div class="footer">\n            <p>Thank you for choosing Sufi Essences - Premium Kashmiri Perfumes</p>\n            <p>If you have any questions, contact us at orders@sufiessences.com</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `,r=`\nOrder Confirmation - Sufi Essences\n\nDear ${e.name},\n\nYour order #${e.orderId} has been confirmed!\n\nOrder Details:\n${e.items.map(e=>`- ${e.name} (Qty: ${e.quantity}) - ₹${(e.price*e.quantity).toFixed(2)}`).join("\n")}\n\nSubtotal: ₹${e.subtotal.toFixed(2)}\nGST (18%): ₹${e.gst.toFixed(2)}\nShipping: ${0===e.shipping?"FREE":"₹"+e.shipping.toFixed(2)}\nTotal: ₹${e.total.toFixed(2)}\n\nShipping Address:\n${e.shippingAddress.street}\n${e.shippingAddress.city}, ${e.shippingAddress.state} ${e.shippingAddress.zipCode}\n${e.shippingAddress.country}\n\nWe'll send you tracking information once your order ships.\n\nThank you for choosing Sufi Essences!\n    `;return{subject:`Order Confirmation #${e.orderId} - Sufi Essences`,htmlContent:n,textContent:r}}},o=Object.freeze(Object.defineProperty({__proto__:null,emailService:s},Symbol.toStringTag,{value:"Module"}));const d=new class{constructor(){t(this,"razorpayKeyId"),t(this,"isTestMode"),this.razorpayKeyId="your_razorpay_key_id",this.isTestMode=!1,this.razorpayKeyId}async loadRazorpayScript(){return new Promise(e=>{if(window.Razorpay)return void e(!0);const t=document.createElement("script");t.src="https://checkout.razorpay.com/v1/checkout.js",t.onload=()=>e(!0),t.onerror=()=>e(!1),document.body.appendChild(t)})}calculateGST(e){const t=parseFloat("0.18");return Math.round(e*t*100)/100}calculateShipping(e,t){return t>=parseFloat("2000")?0:e.toLowerCase().includes("kashmir")||e.toLowerCase().includes("jammu")?parseFloat("50"):parseFloat("100")}async createPaymentOrder(e){try{const t=e.amount,n=this.calculateGST(t),r=this.calculateShipping(e.shippingAddress.state,t),i=t+n+r,a={amount:Math.round(100*i),currency:e.currency,receipt:`order_${Date.now()}`,notes:{customer_name:e.customerInfo.name,customer_email:e.customerInfo.email,items_count:e.items.length.toString(),subtotal:t.toString(),gst:n.toString(),shipping:r.toString(),total:i.toString()}},s=await fetch("/.netlify/functions/create-payment-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const o=await s.json();if(!o.success)throw new Error(o.error||"Failed to create payment order");return o.order}catch(t){throw new Error("Failed to create payment order")}}async processPayment(e){try{if(!(await this.loadRazorpayScript()))throw new Error("Failed to load Razorpay script");const t=await this.createPaymentOrder(e);return new Promise(n=>{const r={key:this.razorpayKeyId,amount:t.amount,currency:t.currency,name:"Sufi Essences",description:"Premium Kashmiri Perfumes & Attars",image:"/logo.png",order_id:t.id,handler:e=>{this.verifyPayment(e).then(()=>{n({success:!0,paymentId:e.razorpay_payment_id})}).catch(e=>{n({success:!1,error:e.message})})},prefill:{name:e.customerInfo.name,email:e.customerInfo.email,contact:e.customerInfo.phone},notes:{address:`${e.shippingAddress.street}, ${e.shippingAddress.city}`,state:e.shippingAddress.state},theme:{color:"#8B5A3C"},modal:{ondismiss:()=>{n({success:!1,error:"Payment cancelled by user"})}}};new window.Razorpay(r).open()})}catch(t){return{success:!1,error:t instanceof Error?t.message:"Payment processing failed"}}}async verifyPayment(e){try{if(!e.razorpay_payment_id||!e.razorpay_order_id||!e.razorpay_signature)throw new Error("Invalid payment response");const t=await fetch("/.netlify/functions/verify-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();if(!n.success||!n.verified)throw new Error(n.error||"Payment verification failed");return!0}catch(t){throw new Error("Payment verification failed")}}getSupportedPaymentMethods(){return[{id:"card",name:"Credit/Debit Card",description:"Visa, Mastercard, RuPay",icon:"💳"},{id:"upi",name:"UPI",description:"Google Pay, PhonePe, Paytm",icon:"📱"},{id:"netbanking",name:"Net Banking",description:"All major banks",icon:"🏦"},{id:"wallet",name:"Wallets",description:"Paytm, Mobikwik, etc.",icon:"👛"},{id:"cod",name:"Cash on Delivery",description:"Pay when you receive",icon:"💵"}]}formatCurrency(e){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:2}).format(e)}isConfigured(){return!!this.razorpayKeyId}};export{a as S,o as a,s as e,d as p,i as r};
//# sourceMappingURL=services-BbBFH2H7.js.map
