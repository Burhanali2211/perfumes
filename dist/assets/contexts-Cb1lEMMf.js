const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/services-BbBFH2H7.js","assets/index-CzTquisR.js","assets/supabase-BIpeaN6O.js","assets/vendor-I9hkboGq.js","assets/ui-CFZ2Pk_Q.js","assets/utils-DOabGuGE.js","assets/product-C38Xnw-V.js","assets/index-Dr8NIB1U.css"])))=>i.map(i=>d[i]);
import{r as e,j as t,af as r,_ as a,T as s,at as o,b as i,b4 as n}from"./vendor-I9hkboGq.js";import{s as c,p as l,_ as d,q as u,t as m,v as g,w as h,x as p,y as f,z as y,B as w,D as v,F as b,G as E,H as A,J as x,K as C,N as P,O as S,P as D,Q as j,S as F,T as I,U as O,V as k,W as N,X as R,Y as T,Z as M,$ as _,a0 as B,a1 as U,a2 as $,a3 as L,a4 as V}from"./index-CzTquisR.js";import{h as q,j as H,k as W,l as J,m as Y,n as z,o as Q}from"./utils-DOabGuGE.js";import{r as G}from"./services-BbBFH2H7.js";const K=e.createContext(void 0),X=()=>{const t=e.useContext(K);if(!t)throw new Error("useError must be used within an ErrorProvider");return t},Z=({children:r})=>{const[a,s]=e.useState(null);return t.jsx(K.Provider,{value:{error:a,setError:s,clearError:()=>s(null)},children:r})},ee=e.createContext(void 0),te=()=>{const t=e.useContext(ee);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},re=({children:r})=>{const[a,s]=e.useState(null),[o,i]=e.useState(!0),[n,g]=e.useState(0),[h,p]=e.useState(!1),[f,y]=e.useState(!1),[w,v]=e.useState("login"),{setError:b}=X();e.useEffect(()=>{(async()=>{try{const e=c.auth.getSession(),t=new Promise((e,t)=>{setTimeout(()=>t(new Error("Session retrieval timed out")),1e4)}),{data:{session:r}}=await Promise.race([e,t]);(null==r?void 0:r.user)&&await E(r.user)}catch(e){b("Authentication initialization failed. Please refresh the page.")}finally{i(!1)}})()},[]),e.useEffect(()=>{const{data:{subscription:e}}=c.auth.onAuthStateChange(async(e,t)=>{try{i(!0),(null==t?void 0:t.user)?await E(t.user):(s(null),b(null),localStorage.removeItem("user_preferences"),localStorage.removeItem("cart_items"))}catch(r){b("Authentication error occurred. Please try refreshing the page.")}finally{i(!1)}});return()=>null==e?void 0:e.unsubscribe()},[]);const E=async e=>{var t,r,a,o;try{const i=await u(e.id);if(i){const t={...i,email:e.email};s(t),b(null)}else{const i=await m({email:e.email,name:(null==(t=e.user_metadata)?void 0:t.full_name)||"",role:(null==(r=e.user_metadata)?void 0:r.role)||"customer",phone:(null==(a=e.user_metadata)?void 0:a.phone)||"",dateOfBirth:(null==(o=e.user_metadata)?void 0:o.date_of_birth)||""});i?s(i):(s(null),b("Failed to create user profile"))}}catch(i){b(i instanceof Error?i.message:"Authentication error"),s(null)}},A=async(e,t)=>{try{const r=c.auth.signInWithPassword({email:e,password:t}),a=new Promise((e,t)=>{setTimeout(()=>t(new Error("Authentication request timed out")),15e3)}),{error:s}=await Promise.race([r,a]);if(s)throw s.message.includes("Invalid login credentials")?new Error("Invalid credentials. Please check your email and password."):s.message.includes("Email not confirmed")?new Error("Please confirm your email address before signing in."):s.message.includes("Too many requests")?new Error("Too many login attempts. Please wait a moment and try again."):s.message.includes("Account is temporarily locked")?new Error("Account is temporarily locked due to too many failed attempts. Please try again later."):s.message.includes("timed out")||s.message.includes("aborted")?new Error("Connection timeout. Please check your internet connection and try again."):new Error(s.message)}catch(r){if(r instanceof Error){if(r.message.includes("timed out")||r.message.includes("aborted"))throw new Error("Connection timeout. Please check your internet connection and try again.");throw r}throw new Error("An unexpected error occurred during sign in.")}},x=async(e,t,r)=>{const{error:a}=await c.auth.signUp({email:e,password:t,options:{data:{full_name:(null==r?void 0:r.fullName)||"",phone:(null==r?void 0:r.phone)||"",date_of_birth:(null==r?void 0:r.dateOfBirth)||"",address:(null==r?void 0:r.address)||"",subscribe_newsletter:(null==r?void 0:r.subscribeNewsletter)||!1,role:"customer"}}});if(a)throw new Error(a.message);try{const{emailService:t}=await d(async()=>{const{emailService:e}=await import("./services-BbBFH2H7.js").then(e=>e.a);return{emailService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7]));await t.sendWelcomeEmail({email:e,name:(null==r?void 0:r.fullName)||"Customer"})}catch(s){}},C=async()=>{const{error:e}=await c.auth.signOut();if(e)throw new Error(e.message);s(null),localStorage.removeItem("user_preferences"),localStorage.removeItem("cart_items")},P=()=>{y(!1)},S={user:a,loading:o,loginAttempts:n,isLocked:h,signIn:A,signUp:x,logout:async()=>{await C()},signOut:C,login:async(e,t)=>{try{return await A(e,t),null}catch(r){return r instanceof Error?r.message:"Login failed"}},register:async e=>{try{return await x(e.email,e.password,{fullName:e.name,phone:e.phone,dateOfBirth:e.dateOfBirth,address:e.address||""}),!0}catch(t){return!1}},resetPassword:async()=>{},updatePassword:async()=>{},resendVerification:async()=>{},updateProfile:async()=>{},openMobileAuth:(e="login")=>{v(e),y(!0)},closeMobileAuth:P,isMobileAuthOpen:f,mobileAuthMode:w};return t.jsxs(ee.Provider,{value:S,children:[r,t.jsx(l,{isOpen:f,onClose:P,initialMode:w})]})},ae=e.createContext(void 0),se=()=>{const t=e.useContext(ae);if(!t)throw new Error("useNotification must be used within a NotificationProvider");return t},oe=({children:n})=>{const[c,l]=e.useState([]),d=e.useRef(new Map),u=e=>{const t=Date.now(),r=`${t}-${Math.random().toString(36).substring(2,9)}`,a=e.duration||5e3;if(c.some(r=>r.type===e.type&&r.message===e.message&&r.title===e.title&&t-r.timestamp<2e3))return;const s={...e,id:r,timestamp:t,duration:a,isVisible:!1,isDismissing:!1};if(l(e=>[s,...e]),setTimeout(()=>{l(e=>e.map(e=>e.id===r?{...e,isVisible:!0}:e))},10),a>0){const e=setTimeout(()=>{m(r)},a);d.current.set(r,e)}},m=e=>{const t=d.current.get(e);t&&(clearTimeout(t),d.current.delete(e)),l(t=>t.map(t=>t.id===e?{...t,isDismissing:!0}:t)),setTimeout(()=>{l(t=>t.filter(t=>t.id!==e))},300)};e.useEffect(()=>()=>{d.current.forEach(e=>clearTimeout(e)),d.current.clear()},[]);const g=({notification:n})=>{const[c,l]=e.useState(100),d=e.useRef(null);e.useEffect(()=>{if(n.duration&&n.duration>0&&n.isVisible&&!n.isDismissing){const e=Date.now(),t=n.duration,r=()=>{const a=Date.now()-e,s=Math.max(0,100-a/t*100);l(s),s>0&&(d.current=setTimeout(r,50))};r()}return()=>{d.current&&clearTimeout(d.current)}},[n.duration,n.isVisible,n.isDismissing]);const u=(()=>{switch(n.type){case"success":return{container:"bg-white border-l-4 border-emerald-500 shadow-lg shadow-emerald-500/20",icon:t.jsx(i,{className:"h-5 w-5 text-emerald-600"}),iconBg:"bg-emerald-50",progress:"bg-emerald-500"};case"error":return{container:"bg-white border-l-4 border-red-500 shadow-lg shadow-red-500/20",icon:t.jsx(o,{className:"h-5 w-5 text-red-600"}),iconBg:"bg-red-50",progress:"bg-red-500"};case"warning":return{container:"bg-white border-l-4 border-amber-500 shadow-lg shadow-amber-500/20",icon:t.jsx(s,{className:"h-5 w-5 text-amber-600"}),iconBg:"bg-amber-50",progress:"bg-amber-500"};default:return{container:"bg-white border-l-4 border-blue-500 shadow-lg shadow-blue-500/20",icon:t.jsx(a,{className:"h-5 w-5 text-blue-600"}),iconBg:"bg-blue-50",progress:"bg-blue-500"}}})();return t.jsxs("div",{className:`\n          ${u.container}\n          rounded-lg overflow-hidden backdrop-blur-sm max-w-sm w-full\n          transform transition-all duration-300 ease-out\n          ${n.isVisible&&!n.isDismissing?"translate-x-0 opacity-100 scale-100":"translate-x-full opacity-0 scale-95"}\n          ${n.isDismissing?"translate-x-full opacity-0 scale-95":""}\n        `,children:[t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"flex items-start",children:[t.jsx("div",{className:`flex-shrink-0 ${u.iconBg} rounded-full p-2 mr-3`,children:u.icon}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-1",children:n.title}),t.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:n.message})]}),t.jsx("button",{onClick:()=>{return e=n.id,void m(e);var e},className:"flex-shrink-0 ml-3 p-1 rounded-lg hover:bg-gray-100 transition-colors duration-200 group",children:t.jsx(r,{className:"h-4 w-4 text-gray-400 group-hover:text-gray-600"})})]})}),n.duration&&n.duration>0&&t.jsx("div",{className:"h-1 bg-gray-200",children:t.jsx("div",{className:`h-full ${u.progress} transition-all duration-75 ease-linear`,style:{width:`${c}%`}})})]})};return e.useEffect(()=>{let e=!1;const t=()=>{e||(requestAnimationFrame(()=>{(()=>{const e=document.querySelector(".notification-container");if(e){const t=window.pageYOffset||document.documentElement.scrollTop,r=Math.max(20,t+20);e.style.top=`${r}px`}})(),e=!1}),e=!0)};return window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[]),t.jsxs(ae.Provider,{value:{showNotification:u,showError:(e,t)=>{const r="type"in e?e:q(e);u({type:"error",title:"Oops! Something went wrong",message:r.userMessage,duration:7e3})},showSuccess:(e,t="Success!")=>{u({type:"success",title:t,message:e,duration:4e3})},showInfo:(e,t="Info")=>{u({type:"info",title:t,message:e,duration:5e3})},showWarning:(e,t="Heads up!")=>{u({type:"warning",title:t,message:e,duration:6e3})}},children:[n,t.jsx("div",{className:"fixed top-4 right-4 z-[9999] pointer-events-none notification-container",style:{position:"fixed",top:"1rem",right:"1rem",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:t.jsx("div",{className:"flex flex-col-reverse gap-3 max-w-sm w-full",children:c.map(e=>t.jsx("div",{className:"pointer-events-auto",children:t.jsx(g,{notification:e})},e.id))})})]})},ie=e.createContext(void 0),ne=()=>{const t=e.useContext(ie);if(!t)throw new Error("useCart must be used within a CartProvider");return t},ce=({children:r})=>{const{user:a}=te(),{showNotification:s}=se(),[o,i]=e.useState([]),[n,c]=e.useState(!0),[l,d]=e.useState([]),u=e.useCallback(()=>{try{const e=localStorage.getItem("guestCart");if(e){const t=JSON.parse(e);return d(t),t}}catch(e){}return[]},[]),m=e.useCallback(e=>{try{localStorage.setItem("guestCart",JSON.stringify(e)),d(e)}catch(t){}},[]),w=e.useCallback(async()=>{if(a&&l.length>0)try{for(const e of l)await g(e.product.id,e.variantId,e.quantity);return localStorage.removeItem("guestCart"),d([]),!0}catch(e){return!1}return!1},[a,l]),v=e.useCallback(async()=>{c(!0);try{if(a){const e=await h();i(e)}else{const e=u();i(e)}}catch(e){s({type:"error",title:"Error",message:"Failed to fetch cart items. Please try again later."})}c(!1)},[a,s,u]);e.useEffect(()=>{v()},[v]),e.useEffect(()=>{a||u()},[a,u]),e.useEffect(()=>{a&&l.length>0&&w().then(e=>{e&&v()})},[a,l.length,w,v]);const b=async e=>{try{if(a){await y(e)?await v():s({type:"error",title:"Error",message:"Failed to remove item from cart."})}else{const t=u().filter(t=>t.product.id!==e);m(t),i(t)}}catch(t){s({type:"error",title:"Error",message:"Failed to remove item from cart. Please try again later."})}},E=o.reduce((e,t)=>e+t.product.price*t.quantity,0),A=o.reduce((e,t)=>e+t.quantity,0),x={items:o,addItem:async(e,t=1)=>{try{if(a){await g(e.id,void 0,t)?(await v(),s({type:"success",title:"Added to Cart",message:`${e.name} has been added.`})):s({type:"error",title:"Error",message:"Could not add item to cart."})}else{const r=u(),a=r.findIndex(t=>t.product.id===e.id);let o;if(a>=0)o=[...r],o[a].quantity+=t;else{const a={id:`guest-${Date.now()}-${e.id}`,product:e,productId:e.id,quantity:t,variantId:void 0,createdAt:new Date};o=[...r,a]}m(o),i(o),s({type:"success",title:"Added to Cart",message:`${e.name} has been added.`})}}catch(r){s({type:"error",title:"Error",message:"Failed to add item to cart. Please try again later."})}},removeItem:b,updateQuantity:async(e,t)=>{if(t<=0)await b(e);else try{if(a){await f(e,t)?await v():s({type:"error",title:"Error",message:"Failed to update item quantity."})}else{const r=u().map(r=>r.product.id===e?{...r,quantity:t}:r);m(r),i(r)}}catch(r){s({type:"error",title:"Error",message:"Failed to update item quantity. Please try again later."})}},clearCart:async()=>{try{if(a){await p()?i([]):s({type:"error",title:"Error",message:"Failed to clear cart."})}else localStorage.removeItem("guestCart"),d([]),i([])}catch(e){s({type:"error",title:"Error",message:"Failed to clear cart. Please try again later."})}},total:E,itemCount:A,loading:n};return t.jsx(ie.Provider,{value:x,children:r})},le=e.createContext(void 0),de=()=>{const t=e.useContext(le);if(!t)throw new Error("useWishlist must be used within a WishlistProvider");return t},ue=({children:r})=>{const{user:a}=te(),{showNotification:s}=se(),[o,i]=e.useState([]),[n,c]=e.useState(!0),l=e.useCallback(async()=>{if(!a)return i([]),void c(!1);c(!0);try{const e=await w();i(e)}catch(e){s({type:"error",title:"Error",message:"Failed to fetch wishlist items. Please try again later."})}c(!1)},[a,s]);e.useEffect(()=>{l()},[l]);const d=async e=>{if(a)try{await v(e)?await l():s({type:"error",title:"Error",message:"Failed to remove item from wishlist."})}catch(t){s({type:"error",title:"Error",message:"Failed to remove item from wishlist. Please try again later."})}},u=e=>o.some(t=>t.product.id===e),m={items:o,addItem:async e=>{if(a)if(u(e.id))await d(e.id),s({type:"info",title:"Removed from Wishlist",message:`${e.name} removed from your wishlist.`});else try{await b(e.id)?(await l(),s({type:"success",title:"Added to Wishlist",message:`${e.name} added to your wishlist.`})):s({type:"error",title:"Error",message:"Could not add item to wishlist."})}catch(t){s({type:"error",title:"Error",message:"Failed to add item to wishlist. Please try again later."})}else s({type:"info",title:"Authentication Required",message:"Please log in or create an account to add items to your wishlist."})},removeItem:d,isInWishlist:u,clearWishlist:async()=>{if(a)try{const e=o.map(e=>v(e.product.id));await Promise.all(e),i([])}catch(e){s({type:"error",title:"Error",message:"Failed to clear wishlist. Please try again later."})}},loading:n};return t.jsx(le.Provider,{value:m,children:r})},me=e.createContext(void 0),ge=()=>{const t=e.useContext(me);if(!t)throw new Error("useProducts must be used within a ProductProvider");return t},he=e.memo(({children:r})=>{const[a,s]=e.useState([]),[o,i]=e.useState([]),[n,l]=e.useState([]),[u,m]=e.useState(!1),[g,h]=e.useState(!1),[p,f]=e.useState(!1),[y,w]=e.useState(!1),[v,b]=e.useState(!1),{setError:k}=X(),{user:N}=te();e.useEffect(()=>{},[]),e.useEffect(()=>{},[a]),e.useEffect(()=>{},[n]),e.useEffect(()=>{},[u,g,p]),e.useEffect(()=>{},[v]);const R=e.useCallback(async()=>{try{const e=H("categories"),t=W.get(e);if(t)return void l(t);const{testDirectRestAPI:r}=await d(async()=>{const{testDirectRestAPI:e}=await import("./index-CzTquisR.js").then(e=>e.bI);return{testDirectRestAPI:e}},__vite__mapDeps([1,2,3,4,5,0,6,7])),a=await r();if(!a.success||!a.data)throw new Error(a.error||"Failed to fetch categories");{const t=a.data.map(e=>({id:e.id,name:e.name,slug:e.slug||e.name.toLowerCase().replace(/\s+/g,"-"),description:e.description||`${e.name} products`,imageUrl:e.image_url||"https://via.placeholder.com/400",parentId:e.parent_id,sortOrder:e.sort_order||0,isActive:!1!==e.is_active,createdAt:new Date(e.created_at||Date.now()),updatedAt:new Date(e.updated_at||Date.now())}));l(t),b(!1),W.set(e,t)}}catch(e){k("Failed to load categories from database"),l([]),b(!1)}},[k]),T=e.useCallback(async(e=8)=>{try{w(!0);const t=H("featured-products",{limit:e}),r=J.get(t);if(r)return i(r),void w(!1);const a=await E(e);i(a),b(!1),J.set(t,a)}catch(t){k("Failed to load featured products from database"),i([]),b(!1)}finally{w(!1)}},[k]),M=e.useCallback(async(e=!1)=>{m(!0),h(!0);try{const r=H("products-basic"),a=H("categories"),o=e?null:J.get(r),i=e?null:W.get(a);if(o&&i)return s(o),l(i),h(!1),void m(!1);try{const[e,t]=await Promise.all([A({limit:50}),x()]);s(e),J.set(r,e),b(!1),l(t),W.set(a,t),b(!1)}catch(t){k("Failed to load data from database"),s([]),l([]),b(!1)}h(!1),e||(f(!0),setTimeout(async()=>{try{const e=await C({limit:50});s(e),J.set("products-full",e)}catch(e){}finally{f(!1)}},100))}catch(r){r instanceof Error&&r.message.includes("infinite recursion")?k("DATABASE SETUP ERROR: Your database security policies are causing an infinite loop. This is a common setup issue. Please run the provided SQL script in your Supabase SQL Editor to fix it."):(k("Failed to load data from database"),s([]),l([]),b(!1)),h(!1),f(!1)}m(!1)},[k]);e.useEffect(()=>{M()},[M]),e.useEffect(()=>{T()},[T]),e.useEffect(()=>{R()},[R]);const _=async e=>{var t;try{const r=null==N?void 0:N.id;await O({name:e.name,description:e.description,price:e.price,categoryId:e.categoryId,sellerId:r,stock:e.stock,imageUrl:(null==(t=e.images)?void 0:t[0])||"",featured:e.featured})&&(z(),await M(!0),k(null))}catch(r){k("Error adding product: "+(r instanceof Error?r.message:"Unknown error"))}},B=async e=>{try{const{id:t,createdAt:r,reviews:a,rating:s,reviewCount:o,...i}=e;await I(t,i)&&(z(),await M(!0),k(null))}catch(t){k("Error updating product: "+(t instanceof Error?t.message:"Unknown error"))}},U=async(e,t)=>{try{await F(e)&&(z(),await M(!0),k(null))}catch(r){k("Error deleting product: "+(r instanceof Error?r.message:"Unknown error"))}},$=async e=>{try{const{data:t,error:r}=await c.from("reviews").select("*, profiles(full_name, avatar_url)").eq("product_id",e).order("created_at",{ascending:!1});return r?[]:t}catch(t){return[]}},L=async e=>{try{const t={productId:e.productId||e.product_id,rating:e.rating,comment:e.comment,title:e.title,createdAt:new Date};await j(t)||k("Failed to submit review")}catch(t){k("Error submitting review: "+(t instanceof Error?t.message:"Unknown error"))}},V=async e=>{try{if(await D({name:e.name,description:e.description,imageUrl:e.imageUrl}))return Y(),await R(),k(null),Promise.resolve()}catch(t){return k("Error adding category: "+(t instanceof Error?t.message:"Unknown error")),Promise.reject(t)}},q=async e=>{try{const{id:t,createdAt:r,updatedAt:a,productCount:s,...o}=e;if(await S(t,o))return Y(),await R(),k(null),Promise.resolve()}catch(t){return k("Error updating category: "+(t instanceof Error?t.message:"Unknown error")),Promise.reject(t)}},Q=async e=>{try{if(await P(e))return Y(),await R(),k(null),Promise.resolve()}catch(t){return k("Error deleting category: "+(t instanceof Error?t.message:"Unknown error")),Promise.reject(t)}},G=e.useMemo(()=>({products:a,featuredProducts:o,categories:n,addProduct:_,updateProduct:B,deleteProduct:U,fetchReviewsForProduct:$,submitReview:L,fetchProducts:M,fetchCategories:R,fetchFeaturedProducts:T,loading:u,basicLoading:g,detailsLoading:p,featuredLoading:y,isUsingMockData:v,addCategory:V,updateCategory:q,deleteCategory:Q}),[a,o,n,u,g,p,y,v,_,B,U,$,L,M,R,T,V,q,Q]);return t.jsx(me.Provider,{value:G,children:r})}),pe=e.createContext(void 0),fe=[{id:"1",name:"Royal Heritage Collection",slug:"royal-heritage",description:"Timeless fragrances inspired by royal traditions and ancient perfumery arts. Each bottle contains centuries of wisdom and craftsmanship, bringing you the essence of royal courts and majestic ceremonies.",shortDescription:"Royal-inspired luxury attars",image:"https://images.unsplash.com/photo-1541643600914-78b084683601?w=400",bannerImage:"https://images.unsplash.com/photo-1541643600914-78b084683601?w=800",type:"heritage",status:"active",price:299,originalPrice:399,discount:25,productIds:["1","2","3"],productCount:12,featured:!0,isExclusive:!0,launchDate:new Date("2024-01-15"),sortOrder:1,tags:["luxury","heritage","royal","exclusive"],metaTitle:"Royal Heritage Collection - Luxury Attars",metaDescription:"Discover our Royal Heritage Collection featuring timeless fragrances inspired by royal traditions.",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-15")},{id:"2",name:"Seasonal Blossoms",slug:"seasonal-blossoms",description:"Fresh floral compositions that capture the essence of each season. From spring cherry blossoms to autumn roses, experience nature's beauty in every drop.",shortDescription:"Seasonal floral fragrances",image:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400",bannerImage:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=800",type:"seasonal",status:"active",price:199,originalPrice:249,discount:20,productIds:["4","5","6"],productCount:8,featured:!0,isExclusive:!1,launchDate:new Date("2024-03-01"),endDate:new Date("2024-06-30"),sortOrder:2,tags:["floral","seasonal","fresh"],metaTitle:"Seasonal Blossoms Collection - Floral Attars",metaDescription:"Experience the beauty of seasonal flowers with our Seasonal Blossoms collection.",createdAt:new Date("2024-02-15"),updatedAt:new Date("2024-03-01")},{id:"3",name:"Limited Edition Oud",slug:"limited-oud",description:"Rare and precious oud compositions available for a limited time only. Sourced from the finest agarwood trees, these exclusive blends represent the pinnacle of oud craftsmanship.",shortDescription:"Exclusive limited oud collection",image:"https://images.unsplash.com/photo-1594736797933-d0401ba2fe65?w=400",bannerImage:"https://images.unsplash.com/photo-1594736797933-d0401ba2fe65?w=800",type:"limited",status:"coming_soon",price:599,originalPrice:799,discount:25,productIds:["7","8"],productCount:5,featured:!0,isExclusive:!0,launchDate:new Date("2024-12-01"),endDate:new Date("2025-02-28"),sortOrder:3,tags:["oud","limited","premium","rare"],metaTitle:"Limited Edition Oud Collection - Rare Attars",metaDescription:"Discover our exclusive Limited Edition Oud collection featuring rare and precious compositions.",createdAt:new Date("2024-10-01"),updatedAt:new Date("2024-11-15")},{id:"4",name:"Modern Fusion",slug:"modern-fusion",description:"Contemporary blends that merge traditional attars with modern perfumery techniques. Innovation meets tradition in these groundbreaking compositions.",shortDescription:"Modern attar innovations",image:"https://images.unsplash.com/photo-1588405748880-12d1d2a59d32?w=400",bannerImage:"https://images.unsplash.com/photo-1588405748880-12d1d2a59d32?w=800",type:"modern",status:"active",price:249,originalPrice:299,discount:17,productIds:["9","10","11"],productCount:10,featured:!1,isExclusive:!1,sortOrder:4,tags:["modern","fusion","contemporary"],metaTitle:"Modern Fusion Collection - Contemporary Attars",metaDescription:"Experience the future of fragrance with our Modern Fusion collection.",createdAt:new Date("2024-05-01"),updatedAt:new Date("2024-06-15")},{id:"5",name:"Signature Classics",slug:"signature-classics",description:"Our most beloved and iconic fragrances that have defined our brand for generations. These timeless classics continue to captivate and inspire.",shortDescription:"Iconic signature fragrances",image:"https://images.unsplash.com/photo-1592945403244-b3fbafd7f539?w=400",bannerImage:"https://images.unsplash.com/photo-1592945403244-b3fbafd7f539?w=800",type:"signature",status:"active",price:179,originalPrice:199,discount:10,productIds:["12","13","14","15"],productCount:15,featured:!0,isExclusive:!1,sortOrder:5,tags:["signature","classic","bestseller"],metaTitle:"Signature Classics Collection - Iconic Attars",metaDescription:"Discover our most beloved Signature Classics collection featuring iconic fragrances.",createdAt:new Date("2023-01-01"),updatedAt:new Date("2024-01-01")}],ye=({children:r})=>{const[a,s]=e.useState([]),[o,i]=e.useState(!0),[n,c]=e.useState(null),{showNotification:l}=se();e.useEffect(()=>{(async()=>{try{i(!0),c(null),await new Promise(e=>setTimeout(e,1e3)),s(fe)}catch(e){c("Failed to load collections")}finally{i(!1)}})()},[]);const d=a.filter(e=>e.featured),u=a.filter(e=>"active"===e.status),m=e=>a.find(t=>t.id===e),g={collections:a,loading:o,error:n,featuredCollections:d,activeCollections:u,getCollectionById:m,getCollectionBySlug:e=>a.find(t=>t.slug===e),addCollection:async e=>{try{const t={...e,id:Date.now().toString(),productCount:e.productIds.length,createdAt:new Date,updatedAt:new Date};return await new Promise(e=>setTimeout(e,500)),s(e=>[...e,t]),l({type:"success",title:"Collection Created",message:`${t.name} has been successfully created.`}),t}catch(t){const e="Failed to create collection";throw c(e),l({type:"error",title:"Creation Failed",message:e}),new Error(e)}},updateCollection:async(e,t)=>{try{const r=m(e);if(!r)throw new Error("Collection not found");const a={...r,...t,id:e,updatedAt:new Date};return await new Promise(e=>setTimeout(e,500)),s(t=>t.map(t=>t.id===e?a:t)),l({type:"success",title:"Collection Updated",message:`${a.name} has been successfully updated.`}),a}catch(r){const e="Failed to update collection";throw c(e),l({type:"error",title:"Update Failed",message:e}),new Error(e)}},deleteCollection:async e=>{try{const t=m(e);if(!t)throw new Error("Collection not found");await new Promise(e=>setTimeout(e,500)),s(t=>t.filter(t=>t.id!==e)),l({type:"success",title:"Collection Deleted",message:`${t.name} has been successfully deleted.`})}catch(t){const e="Failed to delete collection";throw c(e),l({type:"error",title:"Deletion Failed",message:e}),new Error(e)}},refreshCollections:async()=>{try{i(!0),c(null),await new Promise(e=>setTimeout(e,1e3)),s([...fe]),l({type:"success",title:"Collections Refreshed",message:"Collection data has been refreshed successfully."})}catch(e){const t="Failed to refresh collections";c(t),l({type:"error",title:"Refresh Failed",message:t})}finally{i(!1)}}};return t.jsx(pe.Provider,{value:g,children:r})},we=()=>{const t=e.useContext(pe);if(void 0===t)throw new Error("useCollections must be used within a CollectionProvider");return t},ve=e.createContext(void 0),be=()=>{const t=e.useContext(ve);if(!t)throw new Error("useCompare must be used within a CompareProvider");return t},Ee=({children:r})=>{const{user:a}=te(),[s,o]=e.useState(()=>{const e=localStorage.getItem("compare");return e?JSON.parse(e):[]}),{showNotification:i}=se(),[n,c]=e.useState(null);e.useEffect(()=>{localStorage.setItem("compare",JSON.stringify(s))},[s]),e.useEffect(()=>{n&&(i({type:"info",title:"Added to Compare",message:`${n.name} has been added to your compare list.`}),c(null))},[n,i]);const l=e.useCallback(e=>{a?o(t=>t.find(t=>t.id===e.id)?t:t.length>=4?(i({type:"error",title:"Compare List Full",message:"You can only compare up to 4 products at a time."}),t):(c(e),[...t,e])):i({type:"info",title:"Authentication Required",message:"Please log in or create an account to compare products."})},[i,a]),d=e.useCallback(e=>{o(t=>t.filter(t=>t.id!==e))},[]),u=e.useCallback(e=>s.some(t=>t.id===e),[s]),m=e.useCallback(()=>{o([])},[]),g={items:s,addItem:l,removeItem:d,isInCompare:u,clearCompare:m};return t.jsx(ve.Provider,{value:g,children:r})},Ae=e.createContext(void 0),xe=()=>{const t=e.useContext(Ae);if(!t)throw new Error("useOrders must be used within an OrderProvider");return t},Ce=({children:r})=>{const{user:a}=te(),{showNotification:s}=se(),[o,i]=e.useState([]),[n,c]=e.useState(!1),l=e.useCallback(async()=>{if(a){c(!0);try{const e=await k(a.id);i(e)}catch(e){s({type:"error",title:"Error",message:"Failed to load orders. Please try again later."})}finally{c(!1)}}else i([])},[a,s]);e.useEffect(()=>{l()},[l]);const d={orders:o,loading:n,createOrder:async(e,t,r,o="cash_on_delivery")=>{if(!a)return s({type:"error",title:"Authentication Required",message:"Please log in to place an order"}),null;c(!0);try{const a=await T({items:e,shippingAddress:t,billingAddress:r,paymentMethod:o});return a?(s({type:"success",title:"Order Placed",message:"Your order has been placed successfully!"}),await l(),a):(s({type:"error",title:"Order Failed",message:"Failed to create order. Please try again."}),null)}catch(i){return s({type:"error",title:"Order Failed",message:"An unexpected error occurred. Please try again."}),null}finally{c(!1)}},updateOrderStatus:async(e,t)=>{try{await R(e,t)?(await l(),s({type:"success",title:"Status Updated",message:`Order status updated to ${t}`})):s({type:"error",title:"Update Failed",message:"Failed to update order status"})}catch(r){s({type:"error",title:"Update Failed",message:"Failed to update order status. Please try again later."})}},getOrderById:async e=>{try{return await N(e)}catch(t){const r=o.find(t=>t.id===e);return r||null}},getUserOrders:async e=>{const t=e||(null==a?void 0:a.id);if(!t)return[];try{return await k(t)}catch(r){return[]}}};return t.jsx(Ae.Provider,{value:d,children:r})},Pe=e.createContext(void 0),Se=()=>{const t=e.useContext(Pe);if(!t)throw new Error("useAddresses must be used within an AddressProvider");return t},De=({children:r})=>{const[a,s]=e.useState([]),[o,i]=e.useState(!1),{user:n}=te(),{showNotification:c}=se(),l=e.useCallback(async()=>{if(n){i(!0);try{const e=await M();s(e)}catch(e){c({type:"error",title:"Error",message:"Failed to fetch addresses"})}finally{i(!1)}}else s([])},[n,c]);e.useEffect(()=>{l()},[l]);const d={addresses:a,addAddress:async e=>{if(n)try{await $(e)?(await l(),c({type:"success",title:"Address Added",message:"Your address has been added successfully"})):c({type:"error",title:"Error",message:"Failed to add address"})}catch(t){c({type:"error",title:"Error",message:"Failed to add address"})}else c({type:"error",title:"Authentication Required",message:"Please log in to add an address"})},updateAddress:async e=>{try{await U(e)?(await l(),c({type:"success",title:"Address Updated",message:"Your address has been updated successfully"})):c({type:"error",title:"Error",message:"Failed to update address"})}catch(t){c({type:"error",title:"Error",message:"Failed to update address"})}},deleteAddress:async e=>{try{await B(e)?(await l(),c({type:"success",title:"Address Deleted",message:"Your address has been deleted successfully"})):c({type:"error",title:"Error",message:"Failed to delete address"})}catch(t){c({type:"error",title:"Error",message:"Failed to delete address"})}},setDefaultAddress:async(e,t)=>{try{await _(e,t)?(await l(),c({type:"success",title:"Default Address Set",message:`Default ${t} address has been updated`})):c({type:"error",title:"Error",message:"Failed to set default address"})}catch(r){c({type:"error",title:"Error",message:"Failed to set default address"})}},fetchAddresses:l,loading:o};return t.jsx(Pe.Provider,{value:d,children:r})},je=e.createContext(void 0),Fe=({children:r})=>{const{products:a}=ge(),[s,o]=e.useState({related:[],frequentlyBought:[],youMayLike:[],recentlyViewed:[],trending:[],newArrivals:[]}),[i,n]=e.useState(!1),[c,l]=e.useState(null),d=(e,t)=>{let r=0;e.category===t.category&&(r+=40);Math.abs(e.price-t.price)/Math.max(e.price,t.price)<=.3&&(r+=25),e.sellerName&&t.sellerName&&e.sellerName===t.sellerName&&(r+=20);if(Math.abs(e.rating-t.rating)<=.5&&(r+=10),e.tags&&t.tags){r+=e.tags.filter(e=>t.tags.includes(e)).length/Math.max(e.tags.length,t.tags.length)*5}return r},u=(e,t=4)=>{const r=a.find(t=>t.id===e);return r?a.filter(t=>t.id!==e).map(e=>({product:e,score:d(r,e)})).sort((e,t)=>t.score-e.score).slice(0,t).map(e=>e.product):[]},m=(e,t=3)=>{const r=a.find(t=>t.id===e);if(!r)return[];const s={"Oudh Attars":["Amber Attars","Sandalwood Attars","Musk Attars"],"Floral Attars":["Jasmine Attars","Rose Attars","Attar Blends"],"Musk Attars":["Oudh Attars","Amber Attars","Heritage Attars"],"Amber Attars":["Oudh Attars","Saffron Attars","Musk Attars"],"Saffron Attars":["Amber Attars","Heritage Attars","Attar Blends"],"Sandalwood Attars":["Oudh Attars","Musk Attars","Floral Attars"],"Jasmine Attars":["Floral Attars","Attar Blends","Seasonal Attars"],"Attar Blends":["Heritage Attars","Saffron Attars","Seasonal Attars"],"Seasonal Attars":["Attar Blends","Floral Attars","Jasmine Attars"],"Heritage Attars":["Oudh Attars","Saffron Attars","Attar Blends"]};return a.filter(t=>t.id!==e).map(e=>{var t;let a=0;r.category&&e.category&&(null==(t=s[r.category])?void 0:t.includes(e.category))?a+=50:r.category===e.category&&(a+=30);const o=e.price/r.price;return o>=.1&&o<=.6&&(a+=30),a+=10*e.rating,e.stock>0&&(a+=10),{product:e,score:a}}).sort((e,t)=>t.score-e.score).slice(0,t).map(e=>e.product)},g=(e=8)=>{const t=G.getRecentlyViewedProducts(a);if(0===t.length)return a.filter(e=>e.featured||e.rating>=4).sort((e,t)=>e.featured&&!t.featured?-1:!e.featured&&t.featured?1:t.rating-e.rating).slice(0,e);const r=[...new Set(t.map(e=>e.category))],s=[...new Set(t.map(e=>e.sellerName).filter(Boolean))],o=t.reduce((e,t)=>e+t.price,0)/t.length,i=new Set(t.map(e=>e.id));return a.filter(e=>!i.has(e.id)).map(e=>{let t=0;r.includes(e.category)&&(t+=30),e.sellerName&&s.includes(e.sellerName)&&(t+=20),t+=5*e.rating,e.featured&&(t+=10);return Math.abs(e.price-o)/o<=.5&&(t+=10),e.stock>0&&(t+=5),t+=5*Math.random(),{product:e,score:t}}).sort((e,t)=>t.score-e.score).slice(0,e).map(e=>e.product)},h=(e=6)=>G.getRecentlyViewedProducts(a).slice(0,e),p=(e=8)=>a.map(e=>({product:e,score:20*e.rating+(e.featured?30:0)+50*Math.random()})).sort((e,t)=>t.score-e.score).slice(0,e).map(e=>e.product),f=(e=8)=>a.filter(e=>e.createdAt).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).slice(0,e),y=e=>{n(!0),l(null);try{const t={related:e?u(e):[],frequentlyBought:e?m(e):[],youMayLike:g(),recentlyViewed:h(),trending:p(),newArrivals:f()};o(t)}catch(t){l(t instanceof Error?t.message:"Failed to load recommendations")}finally{n(!1)}};e.useEffect(()=>{a.length>0&&y()},[a]),e.useEffect(()=>{const e=()=>{o(e=>({...e,recentlyViewed:h(),youMayLike:g()}))};return window.addEventListener("recentlyViewedUpdated",e),()=>window.removeEventListener("recentlyViewedUpdated",e)},[a]);const w={recommendations:s,loading:i,error:c,getRelatedProducts:u,getFrequentlyBoughtTogether:m,getPersonalizedRecommendations:g,getRecentlyViewed:h,getTrendingProducts:p,getNewArrivals:f,addToRecentlyViewed:e=>{G.addProduct(e),o(e=>({...e,recentlyViewed:h()}))},removeFromRecentlyViewed:e=>{G.removeProduct(e),o(e=>({...e,recentlyViewed:h()}))},clearRecentlyViewed:()=>{G.clearAll(),o(e=>({...e,recentlyViewed:[]}))},getRecommendationAnalytics:()=>({recentlyViewed:G.getAnalytics(),totalRecommendations:Object.values(s).flat().length,categoriesRepresented:[...new Set(Object.values(s).flat().map(e=>e.category))].length,averageRating:Object.values(s).flat().reduce((e,t)=>e+t.rating,0)/Object.values(s).flat().length||0}),refreshRecommendations:y};return t.jsx(je.Provider,{value:w,children:r})},Ie=()=>{const t=e.useContext(je);if(void 0===t)throw new Error("useRecommendations must be used within a RecommendationsProvider");return t},Oe=e.createContext(void 0),ke=()=>{const t=e.useContext(Oe);if(!t)throw new Error("useTheme must be used within a ThemeProvider");return t},Ne=({children:r})=>{const{preferences:a,themeConfig:s,systemPreferences:o,updatePreferences:i,resetToDefaults:n}=Q();e.useEffect(()=>{const e=`Theme changed to ${s.mode} mode with ${s.colorScheme} color scheme`,t=document.createElement("div");t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},1e3)},[s.mode,s.colorScheme]);const c={themeConfig:s,preferences:a,systemPreferences:o,setMode:e=>i({mode:e}),setColorScheme:e=>i({colorScheme:e}),setFontScale:e=>i({fontScale:e}),setBorderRadius:e=>i({borderRadius:e}),setAnimationLevel:e=>i({animationLevel:e}),toggleHighContrast:()=>i({highContrast:!a.highContrast}),toggleReducedMotion:()=>i({reducedMotion:!a.reducedMotion}),updatePreferences:i,resetToDefaults:n,theme:s.mode,actualTheme:s.mode};return t.jsx(Oe.Provider,{value:c,children:r})},Re=e.createContext(void 0),Te=()=>{const t=e.useContext(Re);if(!t)throw new Error("useAuthModal must be used within an AuthModalProvider");return t},Me=({children:r})=>{const[a,s]=e.useState(!1),[o,i]=e.useState(null),[c,l]=e.useState(null),d=()=>{s(!1),i(null),l(null)},u={showAuthModal:(e,t)=>{l(e),i(t),s(!0)},hideAuthModal:d,isModalOpen:a,modalAction:o,selectedProduct:c};return t.jsxs(Re.Provider,{value:u,children:[r,a&&c&&n.createPortal(t.jsx(L,{isOpen:a,onClose:()=>{d()},initialMode:"login"}),document.body)]})},_e=e.memo(({children:e})=>t.jsx(Z,{children:t.jsx(Ne,{children:t.jsx(oe,{children:t.jsx(re,{children:t.jsx(V,{children:t.jsx(Me,{children:t.jsx(he,{children:t.jsx(ye,{children:t.jsx(Fe,{children:t.jsx(ce,{children:t.jsx(ue,{children:t.jsx(Ee,{children:t.jsx(Ce,{children:t.jsx(De,{children:e})})})})})})})})})})})})})}));_e.displayName="CombinedProvider";export{_e as C,ke as a,ge as b,we as c,te as d,ne as e,de as f,be as g,X as h,Te as i,Ie as j,Se as k,xe as l,se as u};
//# sourceMappingURL=contexts-Cb1lEMMf.js.map
